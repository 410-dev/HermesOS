#!/bin/bash
function syslangversion() {
	echo "1.4"
}

function accessible() {
	if [[ "$1" == "c" ]] || [[ "$1" == "r" ]] || [[ "$1" == "w" ]]; then
		echo "$(<$CACHE/init/TouchDown.Security.FilesystemSandbox/$1lim)" | while read limitedLoc
		do
			if [[ ! -z $(echo "$2" | grep "$limitedLoc") ]]; then
				echo "-9"
				break
			fi
		done
	else
		echo "-9"
	fi
}

function fopen() {
	if [[ -f "$1" ]]; then
		if [[ $(accessible "r" "$1") == "0" ]]; then
			echo "0"
		else
			echo "-9"
		fi
	else
		echo "-9"
	fi
}

function fread() {
	if [[ "$(fopen "$1")" == "0" ]]; then
		echo "$(<$1)"
	else
		echo "-9"
	fi
}

function fwrite() {
	if [[ ! -f "$1" ]]; then
		if [[ $(accessible "w" "$1") == "-9" ]]; then
			echo "-9"
		else
			echo "$2" > "$1" 2>/dev/null
			if [[ ! -f "$1" ]]; then
				echo "-9"
			elif [[ "$(<$1)" == "$2" ]]; then
				echo "0"
			else
				echo "-9"
			fi
		fi
	else
		echo "-9"
	fi
}

function foverwrite() {
	if [[ -f "$1" ]]; then
		if [[ $(accessible "w" "$1") == "-9" ]]; then
			echo "-9"
		else
			echo "$2" > "$1" 2>/dev/null
			if [[ ! -f "$1" ]]; then
				echo "-9"
			elif [[ "$(<$1)" == "$2" ]]; then
				echo "0"
			else
				echo "-9"
			fi
		fi
	else
		echo "-9"
	fi
}

function fappend() {
	if [[ -f "$1" ]]; then
		if [[ $(accessible "w" "$1") == "-9" ]]; then
			echo "-9"
		else
			echo "$2" >> "$1"
			if [[ -z "$(echo $(<$1) | grep $2)" ]]; then
				echo "-9"
			else
				echo "0"
			fi
		fi
	else
		echo "-9"
	fi
}

function fdelete() {
	if [[ -f "$1" ]]; then
		if [[ $(accessible "w" "$1") == "-9" ]]; then
			echo "-9"
		else
			rm -rf "$1"
			if [[ -f "$1" ]]; then
				echo "-9"
			else
				echo "0"
			fi
		fi
	else
		echo "-9"
	fi
}

function dopen() {
	if [[ -d "$1" ]]; then
		if [[ $(accessible "r" "$1") == "-9" ]]; then
			echo "-9"
		else
			echo "0"
		fi
	else
		echo "-9"
	fi
}

function dread() {
	if [[ -d "$1" ]]; then
		if [[ $(accessible "r" "$1") == "-9" ]]; then
			echo "-9"
		else
			ls "$1"
		fi
	else
		echo "-9"
	fi
}

function dmake() {
	if [[ $(accessible "w" "$1") == "-9" ]]; then
		echo "-9"
	else
		mkdir -p "$1"
		echo $?
	fi
}

function ddelete() {
	if [[ -d "$1" ]]; then
		if [[ $(accessible "w" "$1") == "-9" ]]; then
			echo "-9"
		else
			rm -rf "$1"
			echo $?
		fi
	else
		echo "-9"
	fi
}

function mplxr() {
	if [[ -f "$MULTIPLEX/$1" ]]; then
		echo "$(<$MULTIPLEX/$1)"
	else
		echo "null"
	fi
}

function mplxw() {
	if [[ ! -d "$MULTIPLEX/$1" ]]; then
		echo "$2" > "$MULTIPLEX/$1"
		if [[ "$(<$MULTIPLEX/$1)" == "$2" ]]; then
			echo "0"
		else
			echo "-9"
		fi
	else
		echo "-9"
	fi
}

function mplxk() {
	if [[ ! -f "$MULTIPLEX/$1" ]]; then
		mkdir "$MULTIPLEX/$1"
		if [[ -d "$MULTIPLEX/$1" ]]; then
			echo "0"
		else
			echo "-9"
		fi
	else
		echo "-9"
	fi
}

function mplxd() {
	if [[ -f "$MULTIPLEX/$1" ]]; then
		rm "$MULTIPLEX/$1"
		echo "0"
	else
		echo "-9"
	fi
}

function netsession() {
	"$SYSTEM/TouchDown/Services/TDFrameworks/TDNetwork" "$1" "$2"
	echo "$?"
}

export -f syslangversion
export -f accessible
export -f fopen
export -f fread
export -f fwrite
export -f foverwrite
export -f fappend
export -f fdelete
export -f dopen
export -f dread
export -f dmake
export -f ddelete
export -f mplxw
export -f mplxr
export -f mplxk
export -f mplxd
export -f netsession